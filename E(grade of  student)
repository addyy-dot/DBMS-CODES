-- Create the database if it doesn't already exist
CREATE DATABASE IF NOT EXISTS StudentDB;

-- Use the newly created database
USE StudentDB;

-- Create the Student table if it doesn't already exist
CREATE TABLE IF NOT EXISTS Student (
    StudentID INT PRIMARY KEY,            -- Unique identifier for each student
    StudentName VARCHAR(50),              -- Name of the student
    Percentage DECIMAL(5,2)              -- Percentage scored by the student
);

-- Insert sample student data into the Student table if they do not already exist
-- The 'IGNORE' option ensures that duplicate entries are ignored (based on StudentID)
INSERT IGNORE INTO Student (StudentID, StudentName, Percentage) VALUES
(1, 'John', 38.5),                      -- Student 1
(2, 'Alice', 45.0),                     -- Student 2
(3, 'Bob', 55.0),                       -- Student 3
(4, 'Charlie', 65.0),                   -- Student 4
(5, 'David', 72.0);                     -- Student 5

-- Drop the function 'GetGrade' if it already exists to avoid conflicts during recreation
DROP FUNCTION IF EXISTS GetGrade;

-- Change the statement delimiter to allow multi-line function creation
DELIMITER //

-- Create a function 'GetGrade' that determines the grade based on the student's percentage
CREATE FUNCTION GetGrade(percentage DECIMAL(5,2)) 
RETURNS VARCHAR(10)   -- Return type is a string representing the grade
DETERMINISTIC         -- The function is deterministic (it will always return the same result for the same input)
BEGIN
    DECLARE grade VARCHAR(10);  -- Declare a variable to store the grade

    -- Check the percentage and determine the grade
    IF percentage <= 40 THEN
        SET grade = 'Pass';       -- Grade is 'Pass' for percentage <= 40
    ELSEIF percentage > 40 AND percentage <= 50 THEN
        SET grade = 'II';         -- Grade is 'II' for percentage > 40 and <= 50
    ELSEIF percentage > 50 AND percentage <= 60 THEN
        SET grade = 'Higher II';  -- Grade is 'Higher II' for percentage > 50 and <= 60
    ELSE
        SET grade = 'I';          -- Grade is 'I' for percentage > 60
    END IF;
    
    RETURN grade;  -- Return the determined grade
END //

-- Reset the delimiter to the default semicolon
DELIMITER ;

-- Select all students from the Student table and calculate their grade using the GetGrade function
SELECT StudentName, Percentage, GetGrade(Percentage) AS Grade
FROM Student;
